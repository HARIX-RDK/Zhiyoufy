"use strict";(self.webpackChunkzhiyoufy_docs=self.webpackChunkzhiyoufy_docs||[]).push([[857],{4556:(e,n,l)=>{l.r(n),l.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>o});var i=l(4848),r=l(8453);const t={title:"zhiyoufy-python\u6982\u8ff0"},a=void 0,s={id:"developer-guide/framework_intro/zhiyoufy-python/intro",title:"zhiyoufy-python\u6982\u8ff0",description:"zhiyoufy-python\u662f\u5f00\u53d1worker\u7684\u57fa\u7840\u6a21\u5757\uff0c\u5b83\u7684\u672c\u8eab\u7ec4\u6210\u4e5f\u5305\u62ec\u4e86\u8bbe\u8ba1\u4e2dworker\u5e94\u8be5\u6709\u7684\u4e00\u4e9b\u90e8\u5206\uff0c",source:"@site/docs/0300-developer-guide/0100-framework_intro/zhiyoufy-python/00100-intro.md",sourceDirName:"0300-developer-guide/0100-framework_intro/zhiyoufy-python",slug:"/developer-guide/framework_intro/zhiyoufy-python/intro",permalink:"/Zhiyoufy/developer-guide/framework_intro/zhiyoufy-python/intro",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:100,frontMatter:{title:"zhiyoufy-python\u6982\u8ff0"},sidebar:"docSidebar",previous:{title:"stomp-over-websocket-rpc",permalink:"/Zhiyoufy/developer-guide/framework_intro/stomp-over-websocket-rpc"},next:{title:"GlobalLibraryBase",permalink:"/Zhiyoufy/developer-guide/framework_intro/zhiyoufy-python/global-library-base"}},c={},o=[{value:"GlobalLibraryBase",id:"globallibrarybase",level:2},{value:"TestDynamicFlowBase",id:"testdynamicflowbase",level:2},{value:"\u6dfb\u52a0\u9700\u8981\u7684handler",id:"\u6dfb\u52a0\u9700\u8981\u7684handler",level:3},{value:"\u6a21\u677f\u7684\u6e32\u67d3",id:"\u6a21\u677f\u7684\u6e32\u67d3",level:3},{value:"case\u8fd0\u884c",id:"case\u8fd0\u884c",level:3},{value:"TestDynamicFlowContext",id:"testdynamicflowcontext",level:3},{value:"handler",id:"handler",level:2},{value:"client",id:"client",level:2},{value:"parent client",id:"parent-client",level:3},{value:"bridge",id:"bridge",level:3},{value:"child client",id:"child-client",level:3}];function d(e){const n={code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"zhiyoufy-python\u662f\u5f00\u53d1worker\u7684\u57fa\u7840\u6a21\u5757\uff0c\u5b83\u7684\u672c\u8eab\u7ec4\u6210\u4e5f\u5305\u62ec\u4e86\u8bbe\u8ba1\u4e2dworker\u5e94\u8be5\u6709\u7684\u4e00\u4e9b\u90e8\u5206\uff0c\n\u4e0b\u9762\u5bf9\u4e3b\u8981\u7ec4\u6210\u8fdb\u884c\u4ecb\u7ecd\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"globallibrarybase",children:"GlobalLibraryBase"}),"\n",(0,i.jsx)(n.p,{children:"\u8fd9\u4e2a\u662f\u4e00\u4e2a\u5168\u5c40\u5355\u4f8b\u5e93\uff0c\u7528\u4e8e\u5b8c\u6210\u6846\u67b6\u7684\u521d\u59cb\u5316\u5de5\u4f5c\uff0c\u7136\u540e\u6301\u6709\u4e00\u4e9b\u5168\u5c40\u5171\u4eab\u7684\u6570\u636e\uff0c\u6bd4\u5982"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"config_inst: \u914d\u7f6e\u6587\u4ef6\u7684\u89e3\u6790"}),"\n",(0,i.jsx)(n.li,{children:"step_vars_map: \u4e0d\u540c\u6d4b\u8bd5\u6b65\u9aa4\u95f4\u5171\u4eab\u6570\u636e\u7684map"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\u5f53\u4f7f\u7528robot framework\u89e6\u53d1\u65f6\u901a\u8fc7\u5728\u8d44\u6e90\u6587\u4ef6\u4e2d\u6307\u5b9a\u521b\u5efa\uff0c\u6bd4\u5982"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"*** Settings ***\nLibrary           xxxx.xxx.GlobalLibrary  ${global_library_config}  WITH NAME    GlobalLibrary\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u5f53\u5728\u672c\u5730\u8c03\u8bd5\u65f6\uff0c\u5728\u4ee3\u7801\u4e2d\u76f4\u63a5\u521b\u5efa\uff0c\u6bd4\u5982"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'    GlobalLibraryBase.g_global_library_base = None\n    GlobalLibrary.g_global_library = None\n    GlobalLibrary.GlobalLibrary("config/zhiyoufy_test/robot.conf")\n'})}),"\n",(0,i.jsx)(n.h2,{id:"testdynamicflowbase",children:"TestDynamicFlowBase"}),"\n",(0,i.jsx)(n.p,{children:"\u4e00\u4e2acase\u662f\u901a\u8fc7\u5728json\u6587\u4ef6\u4e2d\u63cf\u8ff0\u5404\u4e2a\u64cd\u4f5c\u6b65\u9aa4\u6765\u5b9e\u73b0\u7684\uff0c\u4e0d\u540c\u7684\u64cd\u4f5c\u6b65\u9aa4\u53ca\u914d\u7f6e\u4f1a\n\u4ea7\u751f\u4e0d\u540c\u7684case\uff0c\u8fd9\u4e2a\u662f\u57fa\u7840\u652f\u6301\u7c7b"}),"\n",(0,i.jsx)(n.p,{children:"\u5b83\u63d0\u4f9b\u7684\u4e3b\u8981\u529f\u80fd\u5305\u62ec"}),"\n",(0,i.jsx)(n.h3,{id:"\u6dfb\u52a0\u9700\u8981\u7684handler",children:"\u6dfb\u52a0\u9700\u8981\u7684handler"}),"\n",(0,i.jsx)(n.p,{children:"\u6bcf\u4e2ahandler\u53ef\u4ee5\u5904\u7406\u4e00\u90e8\u5206\u6d4b\u8bd5\u6b65\u9aa4\uff0c\u6700\u7ec8\u7684worker\u53ef\u4ee5\u6309\u9700\u52a0\u8f7d\u5bf9\u5e94\u7684handler"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'    def add_handler(self, handler):\n        if handler.type_prefix in self.handler_map:\n            raise Exception("%s is already registered" % handler.type_prefix)\n\n        self.handler_map[handler.type_prefix] = handler\n        handler.setup(self)\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u6a21\u677f\u7684\u6e32\u67d3",children:"\u6a21\u677f\u7684\u6e32\u67d3"}),"\n",(0,i.jsxs)(n.p,{children:["case\u63cf\u8ff0\u6587\u4ef6\u4e2d\u6709\u4e00\u4e9b\u52a8\u6001\u90e8\u5206\uff0c\u6bd4\u5982\u67d0\u4e2a\u6b65\u9aa4\u662f\u5426\u9700\u8981ignore\uff0c\u67d0\u4e2a\u53d8\u91cf\u7684\u503c\u7b49\uff0c\u8fd9\u91cc\u8d1f\u8d23\n\u901a\u8fc7\u89e3\u6790\u7684config\u53ca\u914d\u7f6e\u7684",(0,i.jsx)(n.strong,{children:"override_map"}),"\u6765\u6e32\u67d3"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"        config_path = ConfigUtil.render_config_if_needed(test_config, override_map=override_map)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"case\u8fd0\u884c",children:"case\u8fd0\u884c"}),"\n",(0,i.jsx)(n.p,{children:"\u4f9d\u6b21\u8bfb\u53d6render\u4e4b\u540e\u7684case\u63cf\u8ff0\u6a21\u677f\u4e2d\u7684test case step\uff0c\u6839\u636etype\u9009\u62e9\u76f8\u5e94\u7684handler\u8fdb\u884c\u5904\u7406"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"    def run(self, test_config, override_map=None):\n\n                self.process_datas_node()\n\n    def process_node(self, node_datas, log_prefix):\n\n            self.process_command(data)                                \n"})}),"\n",(0,i.jsx)(n.h3,{id:"testdynamicflowcontext",children:"TestDynamicFlowContext"}),"\n",(0,i.jsx)(n.p,{children:"context\u6570\u636e\uff0c\u4e3b\u8981\u63d0\u4f9bhandler\u5bf9\u5e94client\u548cclient_factory\u7684\u4fdd\u5b58"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"    def add_lib_client_factory(self, lib_client_name, lib_client_factory):\n        self.lib_client_factory_map[lib_client_name] = lib_client_factory\n\n    def get_lib_client(self, lib_client_name):\n        if lib_client_name in self.lib_client_map:\n            return self.lib_client_map[lib_client_name]\n        if lib_client_name in self.lib_client_factory_map:\n            self.lib_client_map[lib_client_name] = self.lib_client_factory_map[lib_client_name]()\n            return self.lib_client_map[lib_client_name]\n"})}),"\n",(0,i.jsx)(n.h2,{id:"handler",children:"handler"}),"\n",(0,i.jsxs)(n.p,{children:["handler\u7528\u4e8e\u5904\u7406case\u63cf\u8ff0\u6587\u4ef6\u4e2d\u7684\u5177\u4f53\u6b65\u9aa4\uff0c\u4e00\u822c\u4e00\u4e2a\u88ab\u6d4b\u4ea7\u54c1\u5c01\u88c5\u4e00\u4e2ahandler\uff0c\u6bd4\u5982\u9488\u5bf9zhiyoufy\u5c31\u6709\n\u5c01\u88c5",(0,i.jsx)(n.code,{children:"DynamicFlowZhiyoufyClient"})]}),"\n",(0,i.jsx)(n.p,{children:"handler\u9700\u8981\u6302\u8f7d\u5230TestDynamicFlowBase\u4e2d"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"        self.add_handler(DynamicFlowZhiyoufyClient())\n"})}),"\n",(0,i.jsx)(n.p,{children:"handler\u7684\u5177\u4f53\u5904\u7406\u901a\u5e38\u7531\u4e00\u4e2a\u5bf9\u5e94\u7684client\u6765\u5904\u7406\uff0c\u8fd9\u4e24\u4e2a\u7684\u533a\u522b\u662f\uff0cclient\u662f\u5bf9\u5bf9\u5e94\u529f\u80fd\u7684\n\u5c01\u88c5\uff0c\u4e0d\u5149\u9762\u5411\u6d4b\u8bd5\uff0c\u4e5f\u9762\u5411\u4e00\u822c\u7684\u81ea\u52a8\u5316\u4f7f\u7528\uff0c\u800chandler\u91cc\u4f1a\u6309\u9700\u5bf9\u6b65\u9aa4\u7684\u7ed3\u679c\u8fdb\u884c\u6548\u9a8c\uff0c\u6bd4\u5982"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'    def process_type_zhiyoufy_config_single_get_single_by_name(self, data):\n        zhiyoufy_client = self.zhiyoufy_client\n\n        target_config_single = zhiyoufy_client.config_single_client.config_single_get_single_by_name(data)\n\n        if "expected_rsp" in data:\n            is_expected = CheckUtil.check_dict_expected(\n                data["expected_rsp"], data["expected_rsp"], target_config_single)\n\n            if not is_expected:\n                self.robot_logger.error(f"{self.log_prefix}: Not match the expected rsp! \\n"\n                                        f" Expected {data[\'expected_rsp\']}\\n Real {target_config_single}")\n                raise Exception(f"zhiyoufy_config_single_get_single_by_name: Not match the expected rsp!")\n'})}),"\n",(0,i.jsx)(n.p,{children:"handler\u6839\u636e\u6d4b\u8bd5step type,\u9009\u62e9\u6b63\u786e\u7684client\u6267\u884c\u6d4b\u8bd5\u8bf7\u6c42\uff0c\u5e76\u5bf9client\u8fd4\u56de\u7684\u6d4b\u8bd5\u8bf7\u6c42\u54cd\u5e94\u8fdb\u884c\u6b63\u786e\u6027\u9a8c\u8bc1"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"        elif data['type'] == 'zhiyoufy_base_login':\n            self.process_type_zhiyoufy_base_login(data)\n        elif data['type'] == 'zhiyoufy_base_logout':\n            self.process_type_zhiyoufy_base_logout(data)\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u4e3a\u4e86\u51cf\u5c11\u8026\u5408\uff0chandler\u4e4b\u95f4\u5404\u81ea\u72ec\u7acb\uff0c\u4e00\u4e2ahandler\u53ea\u4f7f\u7528\u4ece\u5c5e\u4e8e\u5b83\u7684client\uff0c\n\u4e0d\u8de8\u754c\u4f7f\u7528\u5176\u5b83handler\u7684client\uff0c\u5982\u679c\u4e0d\u540chandler\u6709\u6570\u636e\u5171\u4eab\u9700\u6c42\uff0c\u53ef\u901a\u8fc7\nGlobalLibraryBase\u4e2d\u7684\u5168\u5c40step_vars_map\u5b9e\u73b0\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"client",children:"client"}),"\n",(0,i.jsx)(n.p,{children:"client\u662f\u7c7b\u4f3csdk client\u7684\u5bf9\u76ee\u6807\u4ea7\u54c1\u7684client\u4fa7\u5c01\u88c5\uff0c\u5177\u4f53\u5b9e\u73b0\u4e0a\u4e3a\u4e86\u964d\u4f4e\u590d\u6742\u5ea6\uff0c\u4e5f\u4e3a\u4e86\n\u7ef4\u6301\u4e0e\u540e\u7aef\u7684\u4e00\u81f4\uff0c\u4e00\u822c\u90fd\u662f\u7531\u4e00\u4e2aparent client\u548c\u4e00\u7ec4child clients\u7ec4\u6210"}),"\n",(0,i.jsx)(n.h3,{id:"parent-client",children:"parent client"}),"\n",(0,i.jsx)(n.p,{children:"parent client\u5305\u542bchild clients\uff0c\u4e00\u4e9b\u57fa\u672c\u529f\u80fd\u6bd4\u5982login\u3001logout\u53ef\u80fd\u4e5f\u4f1a\u76f4\u63a5\u5728parent\u5b9e\u73b0"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"        self.user_client = ZhiyoufyClientUser(parent_client=self)\n        self.environment_client = ZhiyoufyClientEnvironment(parent_client=self)\n        self.config_single_client = ZhiyoufyClientConfigSingle(parent_client=self)\n        self.config_collection_client = ZhiyoufyClientConfigCollection(parent_client=self)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"bridge",children:"bridge"}),"\n",(0,i.jsx)(n.p,{children:"\u6bcf\u4e2achild client\u90fd\u4f1a\u7ee7\u627f\u81ea\u4e00\u4e2abridge\u57fa\u7c7b\uff0cbridge\u57fa\u7c7b\u8d1f\u8d23\u5c01\u88c5\u5404\u4e2achild client\u53ca\u4e00\u4e9b\u5171\u7528\u7684\u6570\u636e\uff0c\u6bd4\u5982"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"class ZhiyoufyClientBridge(CustomLibraryBridgeBase):\n\n    @property\n    def api_base_url(self):\n        return self.parent_client.api_base_url\n\n    @property\n    def zhiyoufy_addr(self):\n        return self.parent_client.zhiyoufy_addr\n\n    @property\n    def user_client(self):\n        return self.parent_client.user_client\n\n    @property\n    def environment_client(self):\n        return self.parent_client.environment_client\n\n    # pass info between steps, similar to programming variables\n    def get_step_var(self, step_var_path, raise_exception_if_miss=None):\n        return self.parent.get_step_var(step_var_path, raise_exception_if_miss)\n\n    def set_step_var(self, step_var_path, step_var_value):\n        self.parent.set_step_var(step_var_path, step_var_value)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"child-client",children:"child client"}),"\n",(0,i.jsx)(n.p,{children:"\u6839\u636e\u4e1a\u52a1\u529f\u80fd\u6216\u8005\u63a5\u53e3\u5b9a\u4e49\u5212\u5206\u4e0d\u540c\u7684child client"}),"\n",(0,i.jsxs)(n.p,{children:["\u6bd4\u5982",(0,i.jsx)(n.code,{children:"ZhiyoufyClientEnvironment"}),"\u5c31\u88ab\u5c01\u88c5\u7528\u6765\u5904\u7406environment\u7684\u589e\u5220\u6539\u67e5\uff0c\u5bf9\u5e94\u7684\u670d\u52a1\u7aef\u540e\u7aef\u5176\u5b9e\n\u4e5f\u6709\u5bf9\u5e94\u7684\u6a21\u5757\uff0c\u5e76\u4e14\u6709\u7edf\u4e00\u7684url\u524d\u7f00",(0,i.jsx)(n.code,{children:"{self.zhiyoufy_addr}{self.api_base_url}/environment"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"client\u7684\u5b9e\u73b0\u91c7\u7528\u7c7b\u4f3c\u4e8eSDK\u7684\u5f00\u53d1\u65b9\u5f0f\uff0c\u5404\u4e2aclient\u53ea\u505a\u5177\u4f53\u7684\u4e8b\uff0c\u4e0d\u9a8c\u8bc1\u54cd\u5e94\u7ed3\u679c\uff08\u5f53\u7528\u4e8e\u6d4b\u8bd5\u76ee\u7684\u65f6\u7531\u8c03\u7528\u5b83\u7684handler\u8fdb\u884c\u54cd\u5e94\u7ed3\u679c\u9a8c\u8bc1\uff09"}),"\n",(0,i.jsx)(n.li,{children:"\u5404\u4e2achild client\u4e4b\u95f4\u53ef\u4ee5\u901a\u8fc7Global step_var_map\u5b9e\u73b0\u4fe1\u606f\u4f20\u9012"}),"\n",(0,i.jsx)(n.li,{children:"\u6839\u636e\u6d4b\u8bd5\u9700\u6c42\uff0cchild clients\u4e4b\u95f4\u53ef\u4ee5\u6709\u4ea4\u4e92\uff0c\u53ef\u4ee5\u901a\u8fc7bridge\u57fa\u7c7b\u8c03\u7528\u53e6\u4e00\u4e2achild client\u7684\u51fd\u6570"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,l)=>{l.d(n,{R:()=>a,x:()=>s});var i=l(6540);const r={},t=i.createContext(r);function a(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);