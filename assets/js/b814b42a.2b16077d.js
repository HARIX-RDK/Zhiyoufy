"use strict";(self.webpackChunkzhiyoufy_docs=self.webpackChunkzhiyoufy_docs||[]).push([[43],{3690:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>l,contentTitle:()=>s,default:()=>d,frontMatter:()=>o,metadata:()=>t,toc:()=>_});var a=i(4848),r=i(8453);const o={title:"GlobalLibraryBase"},s=void 0,t={id:"developer-guide/framework_intro/zhiyoufy-python/global-library-base",title:"GlobalLibraryBase",description:"\u8fd9\u4e2a\u662f\u4e00\u4e2a\u5168\u5c40\u5355\u4f8b\u5e93\uff0c\u7528\u4e8e\u5b8c\u6210\u6846\u67b6\u7684\u521d\u59cb\u5316\u5de5\u4f5c\uff0c\u7136\u540e\u6301\u6709\u4e00\u4e9b\u5168\u5c40\u5171\u4eab\u7684\u6570\u636e",source:"@site/docs/0300-developer-guide/0100-framework_intro/zhiyoufy-python/00200-global-library-base.md",sourceDirName:"0300-developer-guide/0100-framework_intro/zhiyoufy-python",slug:"/developer-guide/framework_intro/zhiyoufy-python/global-library-base",permalink:"/Zhiyoufy/developer-guide/framework_intro/zhiyoufy-python/global-library-base",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:200,frontMatter:{title:"GlobalLibraryBase"},sidebar:"docSidebar",previous:{title:"zhiyoufy-python\u6982\u8ff0",permalink:"/Zhiyoufy/developer-guide/framework_intro/zhiyoufy-python/intro"},next:{title:"TestDynamicFlowBase",permalink:"/Zhiyoufy/developer-guide/framework_intro/zhiyoufy-python/test-dynamic-flow-base"}},l={},_=[{value:"\u914d\u7f6e\u6570\u636e",id:"\u914d\u7f6e\u6570\u636e",level:2},{value:"\u7f3a\u7701\u914d\u7f6e\u6570\u636e",id:"\u7f3a\u7701\u914d\u7f6e\u6570\u636e",level:3},{value:"\u65e5\u5fd7\u7ba1\u7406",id:"\u65e5\u5fd7\u7ba1\u7406",level:2},{value:"\u8fd0\u884c\u65f6\u6570\u636e",id:"\u8fd0\u884c\u65f6\u6570\u636e",level:2},{value:"step_vars_map",id:"step_vars_map",level:3},{value:"\u5982\u4f55\u4f7f\u7528step_vars_map",id:"\u5982\u4f55\u4f7f\u7528step_vars_map",level:3}];function c(n){const e={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,r.R)(),...n.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e.p,{children:"\u8fd9\u4e2a\u662f\u4e00\u4e2a\u5168\u5c40\u5355\u4f8b\u5e93\uff0c\u7528\u4e8e\u5b8c\u6210\u6846\u67b6\u7684\u521d\u59cb\u5316\u5de5\u4f5c\uff0c\u7136\u540e\u6301\u6709\u4e00\u4e9b\u5168\u5c40\u5171\u4eab\u7684\u6570\u636e"}),"\n",(0,a.jsx)(e.h2,{id:"\u914d\u7f6e\u6570\u636e",children:"\u914d\u7f6e\u6570\u636e"}),"\n",(0,a.jsxs)(e.p,{children:["\u914d\u7f6e\u6570\u636e\u4f7f\u7528",(0,a.jsx)(e.a,{href:"https://github.com/lightbend/config/blob/main/HOCON.md",children:"HOCON"}),"\u683c\u5f0f\uff0c\u4f7f\u7528",(0,a.jsx)(e.a,{href:"https://github.com/chimpler/pyhocon",children:"pyhocon"}),"\u89e3\u6790\uff0c\u7136\u540e\u4fdd\u5b58\u5728zhiyoufy_context\u4e2d"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-python",children:"class GlobalLibraryBase:\n    def __init__(self, config_file):\n\n        init_app_base.init_app_base(config_file)        \n"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-python",children:"def init_app_base(config_path, init_app_default_configs=None, check_dir_names=None):\n\n    config_inst = config.params_from_file(config_file, overrides)\n\n    zhiyoufy_context.set_config_inst(config_inst)\n"})}),"\n",(0,a.jsx)(e.h3,{id:"\u7f3a\u7701\u914d\u7f6e\u6570\u636e",children:"\u7f3a\u7701\u914d\u7f6e\u6570\u636e"}),"\n",(0,a.jsx)(e.p,{children:"\u4e3a\u4e86\u65b9\u4fbf\u4f7f\u7528\uff0c\u914d\u7f6e\u9879\u5e94\u6709\u7f3a\u7701\u503c\uff0c\u7528\u6237\u5e94\u53ea\u9700\u6307\u5b9a\u4e0e\u7f3a\u7701\u503c\u4e0d\u540c\u7684\u914d\u7f6e\uff0c\u6216\u8005\u4e3a\u4e86\u660e\u786e\u800c\u6307\u5b9a"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-python",children:'class GlobalLibraryBase:\n    def __init__(self, config_file):\n\n        self.init_default_config_base()\n        self.init_default_config()\n\n    def init_default_config_base(self):\n\n        if "rm_old_days" not in self.config_inst:\n            self.config_inst.rm_old_days = 30                    \n'})}),"\n",(0,a.jsx)(e.h2,{id:"\u65e5\u5fd7\u7ba1\u7406",children:"\u65e5\u5fd7\u7ba1\u7406"}),"\n",(0,a.jsx)(e.p,{children:"\u521d\u59cb\u5316logging\u76f8\u5173\uff0c\u6bd4\u5982\u914d\u7f6e\u8f93\u51fa\u76ee\u7684\u5730, console, file\u6216\u8005\u90fd\uff0c\u914d\u7f6elog\u4fdd\u5b58\u65f6\u95f4\u7b49"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-python",children:'class GlobalLibraryBase:\n    def __init__(self, config_file):\n\n        init_app_base.init_app_base(config_file)\n\ndef init_app_base(config_path, init_app_default_configs=None, check_dir_names=None):\n\n    setup_logging()\n    setup_normal_logger()\n    setup_robot_logger()     \n\ndef setup_logging():\n\n    if "file_handler" in config_inst.log_handlers:\n        log_config["handlers"]["file_handler"]["filename"] = os.path.join(log_dir, "app.log")\n        log_config["handlers"]["file_handler"]["backupCount"] = config_inst.log_backupCount\n    else:\n        del log_config["handlers"]["file_handler"]\n        log_config["root"]["handlers"].remove("file_handler")\n        file_handler_on = False                         \n'})}),"\n",(0,a.jsx)(e.h2,{id:"\u8fd0\u884c\u65f6\u6570\u636e",children:"\u8fd0\u884c\u65f6\u6570\u636e"}),"\n",(0,a.jsxs)(e.p,{children:["\u6211\u4eec\u7684case\u63cf\u8ff0\u6a21\u677f\u4e2d\u5b9a\u4e49\u4e86\u4e00\u4e2a\u4e2a\u7684\u6d4b\u8bd5\u6b65\u9aa4\uff0c\u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u540e\u9762\u7684\u6d4b\u8bd5\u6b65\u9aa4\u6709\u53ef\u80fd\u9700\u8981\u4f7f\u7528\u5230\u524d\u9762\u6d4b\u8bd5\u6b65\u9aa4\u5f97\u5230\u7684\u7ed3\u679c\uff0c\u8fd9\u4e9b\u7ed3\u679c\u6570\u636e\u6211\u4eec\u79f0\u4e4b\u4e3a\u8fd0\u884c\u65f6\u6570\u636eRun-Time Data\u3002 ",(0,a.jsx)(e.code,{children:"GlobalLibraryBase"}),"\u5e2e\u6211\u4eec\u5b9e\u73b0\u4e86\u8fd9\u4e9bRun-Time Data\u7684\u4fdd\u5b58\u548c\u83b7\u53d6\uff0c\u53ef\u4ee5\u4f5c\u4e3aGlobal Variable\u5728\u6240\u6709\u7c7b\u548c\u51fd\u6570\u4e2d\u5171\u4eab\u8fd9\u4e9b\u6570\u636e\u3002"]}),"\n",(0,a.jsx)(e.h3,{id:"step_vars_map",children:"step_vars_map"}),"\n",(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.code,{children:"GlobalLibraryBase"}),"\u4e2d\u5b9a\u4e49\u4e86",(0,a.jsx)(e.em,{children:"step_vars_map"}),"\u7528\u6765\u4fdd\u5b58Run-Time Data\u3002\u4f7f\u7528\u65f6\u6ca1\u6709\u7279\u522b\u7684\u8981\u6c42\uff0cmap\u7684key\u503c\u548cvalue\u503c\u90fd\u7531\u4f7f\u7528\u8005\u81ea\u5df1\u51b3\u5b9a\u3002"]}),"\n",(0,a.jsx)(e.h3,{id:"\u5982\u4f55\u4f7f\u7528step_vars_map",children:"\u5982\u4f55\u4f7f\u7528step_vars_map"}),"\n",(0,a.jsxs)(e.p,{children:["\u6bd4\u5982\uff0c \u6211\u5728\u67d0\u4e2a\u6d4b\u8bd5\u6b65\u9aa4\u4e2d\u62ff\u5230\u4e86",(0,a.jsx)(e.strong,{children:"environment_var"}),"\u503c\uff0c\u800c\u5728\u540e\u9762\u7684\u6b65\u9aa4\u4e2d\u53c8\u8981\u4f7f\u7528\u8fd9\u4e2a",(0,a.jsx)(e.strong,{children:"environment_var"}),"\uff0c\u90a3\u4e48\u6211\u53ef\u4ee5\u8fd9\u6837\u5b9e\u73b0\uff1a"]}),"\n",(0,a.jsxs)(e.ol,{children:["\n",(0,a.jsxs)(e.li,{children:["\u914d\u7f6e",(0,a.jsx)(e.strong,{children:"environment_var"})]}),"\n"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-json",children:'    {\n        "type": "zhiyoufy_environment_get_single_by_name",\n        "environment_var_path": "environment_var",\n        "name": "{{ env_name }}",\n        "must_exist": true,\n        "step_description": "\u67e5\u627e\u540d\u5b57\u4e3aname\u7684environment"\n    },\n'})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-python",children:'class ZhiyoufyClientEnvironment(ZhiyoufyClientBridge):\n\n    def environment_get_single_by_name(self, params, trace_on=True):\n\n            environment_var_path = params.get("environment_var_path", None)\n\n            if environment_var_path:\n                self.set_step_var(environment_var_path, target_environment)                    \n'})}),"\n",(0,a.jsxs)(e.ol,{start:"2",children:["\n",(0,a.jsxs)(e.li,{children:["\u4f7f\u7528",(0,a.jsx)(e.strong,{children:"environment_var"})]}),"\n"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-json",children:'    {\n      "type": "zhiyoufy_config_single_get_single_by_name",\n      "environment_var_path": "environment_var",\n      "config_single_var_path": "config_single_var",\n      "name": "config_single_for_test_crud_{{ params_group_4_item_name }}",\n      "step_description": "\u67e5\u627e\u540d\u5b57\u4e3aname\u7684config_single"\n    },\n'})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-python",children:'class ZhiyoufyClientConfigSingle(ZhiyoufyClientBridge):\n\n    def config_single_get_single_by_name(self, params, trace_on=True):\n\n            environment_var_path = params["environment_var_path"]\n\n            config_single_list = self.config_single_get_list({\n                "environment_var_path": environment_var_path,\n                "exactMatch": True,\n                "keyword": name,\n            })\n\n    def config_single_get_list(self, params, trace_on=True):\n\n            environment_var_path = params["environment_var_path"]\n\n            target_environment = self.get_step_var(environment_var_path)                                   \n'})})]})}function d(n={}){const{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,a.jsx)(e,{...n,children:(0,a.jsx)(c,{...n})}):c(n)}},8453:(n,e,i)=>{i.d(e,{R:()=>s,x:()=>t});var a=i(6540);const r={},o=a.createContext(r);function s(n){const e=a.useContext(o);return a.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function t(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:s(n.components),a.createElement(o.Provider,{value:e},n.children)}}}]);