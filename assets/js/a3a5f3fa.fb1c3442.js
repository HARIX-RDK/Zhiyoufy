"use strict";(self.webpackChunkzhiyoufy_docs=self.webpackChunkzhiyoufy_docs||[]).push([[879],{8065:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>f,frontMatter:()=>l,metadata:()=>r,toc:()=>a});var t=i(4848),o=i(8453);const l={title:"Handler"},s=void 0,r={id:"developer-guide/framework_intro/zhiyoufy-python/handler",title:"Handler",description:"\u53c2\u4e0e\u81ea\u52a8\u5316\u6d4b\u8bd5\u7684\u6bcf\u4e2a\u529f\u80fd\u6a21\u5757\uff0c\u6211\u4eec\u90fd\u8981\u4e3a\u5176\u5b9a\u4e49\u4e00\u4e2ahandler\u7c7b\uff0c\u6307\u5b9a\u4e00\u4e2atype_prefix, \u5e76\u5b9e\u73b0\u4e0b\u5217\u51fd\u6570",source:"@site/docs/0300-developer-guide/0100-framework_intro/zhiyoufy-python/00400-handler.md",sourceDirName:"0300-developer-guide/0100-framework_intro/zhiyoufy-python",slug:"/developer-guide/framework_intro/zhiyoufy-python/handler",permalink:"/Zhiyoufy/developer-guide/framework_intro/zhiyoufy-python/handler",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:400,frontMatter:{title:"Handler"},sidebar:"docSidebar",previous:{title:"TestDynamicFlowBase",permalink:"/Zhiyoufy/developer-guide/framework_intro/zhiyoufy-python/test-dynamic-flow-base"},next:{title:"Client",permalink:"/Zhiyoufy/developer-guide/framework_intro/zhiyoufy-python/client"}},c={},a=[{value:"handler\u5c01\u88c5",id:"handler\u5c01\u88c5",level:2},{value:"type_prefix",id:"type_prefix",level:3},{value:"handler\u52a0\u8f7d",id:"handler\u52a0\u8f7d",level:2},{value:"case\u63cf\u8ff0",id:"case\u63cf\u8ff0",level:2}];function d(e){const n={code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"\u53c2\u4e0e\u81ea\u52a8\u5316\u6d4b\u8bd5\u7684\u6bcf\u4e2a\u529f\u80fd\u6a21\u5757\uff0c\u6211\u4eec\u90fd\u8981\u4e3a\u5176\u5b9a\u4e49\u4e00\u4e2ahandler\u7c7b\uff0c\u6307\u5b9a\u4e00\u4e2atype_prefix, \u5e76\u5b9e\u73b0\u4e0b\u5217\u51fd\u6570"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'    self.type_prefix = "newmodule_client_"\n\n    def setup(self, dynamic_flow_base_inst):\n        self.config_inst = dynamic_flow_base_inst.config_inst\n        self.context = dynamic_flow_base_inst.context\n        self.robot_logger = dynamic_flow_base_inst.robot_logger\n\n        # "newmodule_client"\u662f\u5411TestDynamicFlowContext\u6ce8\u518c\u65f6\uff0c\u4e0eparent client\u5b9e\u4f8b\u76f8\u5bf9\u5e94\u7684key\u503c\n        self.context.add_lib_client_factory("newmodule_client", self.build_newmodule_client)\n\n    def cleanup(self, case_context):\n        ##case\u6267\u884c\u7ed3\u675f\u65f6\u7684\u6e05\u7406\u5de5\u4f5c\n        pass\n\n    def build_newmodule_client(self):\n        ##\u6240\u62e5\u6709\u7684parent client\u7684\u6784\u9020\u65b9\u6cd5\n        pass\n\n    def process(self, data):\n        # \u6839\u636edata["type"]\u7684\u503c\u8c03\u7528\u76f8\u5e94\u7684client\u6267\u884c\u6d4b\u8bd5\u6b65\u9aa4\n        pass\n'})}),"\n",(0,t.jsx)(n.h2,{id:"handler\u5c01\u88c5",children:"handler\u5c01\u88c5"}),"\n",(0,t.jsxs)(n.p,{children:["handler\u7528\u4e8e\u5904\u7406case\u63cf\u8ff0\u6587\u4ef6\u4e2d\u7684\u5177\u4f53\u6b65\u9aa4\uff0c\u4e00\u822c\u4e00\u4e2a\u88ab\u6d4b\u4ea7\u54c1\u5c01\u88c5\u4e00\u4e2ahandler\uff0c\u6bd4\u5982\u9488\u5bf9zhiyoufy\u5c31\u6709\n\u5c01\u88c5",(0,t.jsx)(n.code,{children:"DynamicFlowZhiyoufyClient"})]}),"\n",(0,t.jsx)(n.h3,{id:"type_prefix",children:"type_prefix"}),"\n",(0,t.jsx)(n.p,{children:"type_prefix\u7528\u4e8e\u6307\u5b9a\u8fd9\u4e2ahandler\u5904\u7406\u7684\u6b65\u9aa4type\u7684\u524d\u7f00"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'class DynamicFlowZhiyoufyClient:\n    def __init__(self):\n\n        self.type_prefix = "zhiyoufy_"\n'})}),"\n",(0,t.jsx)(n.p,{children:"\u5728handler\u5185\u90e8\u4e2d\u5e94\u8be5\u6309\u7167\u5b50\u6a21\u5757\u8fdb\u884c\u8fdb\u4e00\u6b65\u5212\u5206\uff0c\u6bd4\u5982"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"    def process(self, data):\n        if data['type'].startswith('zhiyoufy_base_'):\n            self.process_type_of_zhiyoufy_base(data)\n        elif data['type'].startswith('zhiyoufy_config_collection_'):\n            self.process_type_of_zhiyoufy_config_collection(data)\n        elif data['type'].startswith('zhiyoufy_config_item_'):\n            self.process_type_of_zhiyoufy_config_item(data)\n        elif data['type'].startswith('zhiyoufy_config_single_'):\n            self.process_type_of_zhiyoufy_config_single(data)\n"})}),"\n",(0,t.jsx)(n.h2,{id:"handler\u52a0\u8f7d",children:"handler\u52a0\u8f7d"}),"\n",(0,t.jsxs)(n.p,{children:["handler\u9700\u8981\u6302\u8f7d\u5230TestDynamicFlowBase\u4e2d\uff0c\u4e3a\u4e86\u52a0\u8f7d\u5b83\u9700\u8981\u56fa\u5b9a\u51e0\u4e2a\u51fd\u6570\uff0c\u6bd4\u5982",(0,t.jsx)(n.code,{children:"setup"}),", ",(0,t.jsx)(n.code,{children:"cleanup"})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"setup"}),"\u901a\u5e38\u7528\u4e8e\u6dfb\u52a0\u76f8\u5173client\u5230context\u4e2d\uff0c\u6bd4\u5982"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'    def setup(self, dynamic_flow_base_inst):\n        self.config_inst = dynamic_flow_base_inst.config_inst\n        self.robot_logger = dynamic_flow_base_inst.robot_logger\n        self.context = dynamic_flow_base_inst.context\n\n        self.context.add_lib_client_factory("zhiyoufy_client", self.build_zhiyoufy_client)\n\n    def build_zhiyoufy_client(self):\n        if self._zhiyoufy_client is None:\n            from zhiyoufy.clients.zhiyoufyclient.zhiyoufy_client import ZhiyoufyClient\n            self._zhiyoufy_client = ZhiyoufyClient()\n        return self._zhiyoufy_client        \n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"cleanup"}),"\u7528\u4e8e\u6e05\u7406\uff0c\u6bd4\u5982\u8d26\u53f7logout"]}),"\n",(0,t.jsx)(n.h2,{id:"case\u63cf\u8ff0",children:"case\u63cf\u8ff0"}),"\n",(0,t.jsxs)(n.p,{children:["case\u63cf\u8ff0\u4e2d\u6709\u6d4b\u8bd5\u6b65\u9aa4\u5217\u8868\uff0c\u6bcf\u4e00\u9879\u6307\u5b9a\u4e00\u4e2a\u6d4b\u8bd5\u6b65\u9aa4\uff0c\u5b83\u7684\u524d\u7f00\u6307\u5b9a\u7531\u54ea\u4e2ahandler\u5904\u7406\uff0c\u6bd4\u5982\u4e0b\u9762\u7684\n\u6b65\u9aa4type\u662f",(0,t.jsx)(n.code,{children:"zhiyoufy_environment_get_single_by_name"}),"\uff0c\u5b83\u7684\u524d\u7f00",(0,t.jsx)(n.code,{children:"zhiyoufy_"}),"\u5c31\u662f\n",(0,t.jsx)(n.code,{children:"DynamicFlowZhiyoufyClient"}),"\u6240\u6307\u5b9a\u7684\uff0c\u6240\u4ee5\u4f1a\u8f6c\u7ed9\u5b83\u5904\u7406"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'    {\n        "type": "zhiyoufy_environment_get_single_by_name",\n        "environment_var_path": "environment_var",\n        "name": "{{ env_name }}",\n        "must_exist": true,\n        "step_description": "\u67e5\u627e\u540d\u5b57\u4e3aname\u7684environment"\n    },\n'})})]})}function f(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>s,x:()=>r});var t=i(6540);const o={},l=t.createContext(o);function s(e){const n=t.useContext(l);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),t.createElement(l.Provider,{value:n},e.children)}}}]);