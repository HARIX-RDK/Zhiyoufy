"use strict";(self.webpackChunkzhiyoufy_docs=self.webpackChunkzhiyoufy_docs||[]).push([[185],{2736:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>p,contentTitle:()=>s,default:()=>a,frontMatter:()=>t,metadata:()=>c,toc:()=>l});var i=r(4848),o=r(8453);const t={},s=void 0,c={id:"developer-guide/framework_intro/stomp-over-websocket-rpc",title:"stomp-over-websocket-rpc",description:"intro",source:"@site/docs/0300-developer-guide/0100-framework_intro/00400-stomp-over-websocket-rpc.md",sourceDirName:"0300-developer-guide/0100-framework_intro",slug:"/developer-guide/framework_intro/stomp-over-websocket-rpc",permalink:"/Zhiyoufy/developer-guide/framework_intro/stomp-over-websocket-rpc",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:400,frontMatter:{},sidebar:"docSidebar",previous:{title:"prepare",permalink:"/Zhiyoufy/developer-guide/framework_intro/prepare"},next:{title:"zhiyoufy-python\u6982\u8ff0",permalink:"/Zhiyoufy/developer-guide/framework_intro/zhiyoufy-python/intro"}},p={},l=[{value:"intro",id:"intro",level:2},{value:"stomp",id:"stomp",level:2},{value:"stomp rpc",id:"stomp-rpc",level:2},{value:"\u76d1\u542c\u5730\u5740",id:"\u76d1\u542c\u5730\u5740",level:3},{value:"\u81ea\u5b9a\u4e49header",id:"\u81ea\u5b9a\u4e49header",level:3},{value:"normal flow",id:"normal-flow",level:3},{value:"appDestination\u7ea6\u5b9a",id:"appdestination\u7ea6\u5b9a",level:3},{value:"ping pong",id:"ping-pong",level:3}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"intro",children:"intro"}),"\n",(0,i.jsx)(n.p,{children:"\u6709\u7684\u7ec8\u7aef\u4e0d\u80fd\u542f\u52a8server\u76d1\u542c\uff0c\u4ece\u800c\u4e0d\u80fd\u505a\u4e3aserver\u5bf9\u5916\u63d0\u4f9brpc\u670d\u52a1\n(\u6bd4\u5982\u5904\u4e8e\u5b89\u5168\u8003\u8651\uff0c\u6bd4\u5982browser\u4fa7)"}),"\n",(0,i.jsx)(n.p,{children:"\u90a3\u4e5f\u5c31\u662f\u8bf4\u8981\u548c\u7ec8\u7aef\u901a\u4fe1\u9700\u8981\u7ec8\u7aef\u4e3b\u52a8\u53d1\u8d77\u8fde\u63a5\uff0c\u56e0\u4e3a\u6211\u4eec\u9700\u8981\u8fdc\u7aef\u81ea\u52a8\u5316\u670d\u52a1\u80fd\n\u4e3b\u52a8\u53d1\u9001\u6d88\u606f\u7ed9\u7ec8\u7aef\uff0c\u6240\u4ee5\u9700\u8981\u662f\u4e00\u4e2a\u957f\u8fde\u63a5\uff0c\u90a3\u4e48\u5df2\u6709\u7684\u534f\u8bae\u6709grpc\u548cwebsocket\uff0c\ngrpc\u6bd4\u8f83\u91cd\uff0c\u5e76\u4e14\u5728browser\u4e0a\u4e5f\u6ca1\u6cd5\u8dd1\uff0c\u6240\u4ee5\u6211\u4eec\u9009\u62e9\u4f7f\u7528websocket\u3002"}),"\n",(0,i.jsx)(n.p,{children:"grpc\u662f\u4e00\u4e2a\u5b8c\u6574\u7684rpc\u65b9\u6848\uff0c\u800cwebsocket\u5219\u53ea\u662f\u4e00\u4e2a\u5e95\u5c42\u901a\u4fe1\u673a\u5236\uff0c\u57fa\u4e8ewebsocket\u4e0a\u5b9e\u73b0\nrpc\u8fd8\u9700\u8981\u9009\u62e9\u4e00\u4e2a\u5177\u4f53\u7684\u534f\u8bae\uff0c\u5df2\u6709\u7684\u6709stomp, json-rpc\u7b49\uff0c\u8fd9\u91cc\u6211\u4eec\u9009\u62e9stomp\uff0c\u56e0\u4e3a\n\u5b83\u548chttp\u6bd4\u8f83\u63a5\u8fd1\uff0c\u5f88\u597d\u7406\u89e3\uff0c\u4e5f\u662f\u5206header\u548cbody\uff0c\u7136\u540e\u8fd8\u53ef\u4ee5\u901a\u8fc7stomp server\u6bd4\u5982\nrabbitmq\u505a\u8def\u7531\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"stomp",children:"stomp"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://stomp.github.io/stomp-specification-1.2.html",children:"https://stomp.github.io/stomp-specification-1.2.html"})}),"\n",(0,i.jsx)(n.h2,{id:"stomp-rpc",children:"stomp rpc"}),"\n",(0,i.jsx)(n.h3,{id:"\u76d1\u542c\u5730\u5740",children:"\u76d1\u542c\u5730\u5740"}),"\n",(0,i.jsx)(n.p,{children:"\u4e3a\u4e86\u7075\u6d3b\uff0c\u7ec8\u7aef\u4e0d\u76f4\u63a5\u8fde\u63a5\u5230\u81ea\u52a8\u5316\u670d\u52a1\u5668\uff0c\u800c\u662f\u901a\u8fc7\u4e00\u4e2astomp broker\u4e2d\u8f6c\uff0c\u600e\u4e48\u533a\u5206\u5177\u4f53\u662f\u53d1\u7ed9\n\u54ea\u4e2a\u7ec8\u7aef\u7684\u5219\u662f\u901a\u8fc7\u6bcf\u4e2a\u7ec8\u7aefsubscribe\u4e13\u5c5e\u81ea\u5df1\u7684topic\u6765\u5b9e\u73b0\u7684\uff0c\u6bd4\u5982\u7c7b\u4f3c\u4e0b\u9762\u4ee3\u7801\uff0c\u4e00\u4e2a\u7ec8\u7aef\u5206\u914d\n\u4e00\u4e2a\u552f\u4e00\u7684controllerId"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"    const subscription = this.stompClient.subscribe(\n        `/topic/stomp-controller-${this.controllerId}`, this.onControllerMessage.bind(this));\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u81ea\u5b9a\u4e49header",children:"\u81ea\u5b9a\u4e49header"}),"\n",(0,i.jsx)(n.p,{children:"\u8fd9\u91cc\u6211\u4eec\u5b9a\u4e49\u4e86\u51e0\u4e2a\u6d88\u606fheader\uff0c\u5177\u4f53\u610f\u4e49\u5982\u4e0b"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"appDestination: \u4ee3\u8868\u672c\u5730\u5e94\u7528\u5c42\u5730\u5740"}),"\n",(0,i.jsx)(n.li,{children:"replyDestination: \u4ee3\u8868\u6d88\u606f\u54cd\u5e94\u76ee\u6807\u5730\u5740"}),"\n",(0,i.jsx)(n.li,{children:"replyAppDestination: \u4ee3\u8868\u6d88\u606f\u54cd\u5e94\u76ee\u7684\u5e94\u7528\u5c42\u5730\u5740"}),"\n",(0,i.jsx)(n.li,{children:"streamId: \u6d88\u606f\u6d41\u6807\u8bc6\uff0c\u7c7b\u4f3cgprc\u7684stream id\uff0c\u7528\u4e8e\u533a\u5206\u4e0d\u540crpc\u8c03\u7528"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"normal-flow",children:"normal flow"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u53d1\u9001\u6d88\u606f\u65b9\u914d\u7f6e\u6d88\u606f\u5934",(0,i.jsx)(n.code,{children:"appDestination"}),", ",(0,i.jsx)(n.code,{children:"streamId"}),", ",(0,i.jsx)(n.code,{children:"replyDestination"}),"\u548c",(0,i.jsx)(n.code,{children:"replyAppDestination"})]}),"\n",(0,i.jsx)(n.li,{children:"\u7136\u540e\u53d1\u9001\u5230\u76ee\u6807\u63a5\u6536\u65b9\u5bf9\u5e94\u7684topic\u5730\u5740"}),"\n",(0,i.jsxs)(n.li,{children:["\u63a5\u6536\u65b9\u6536\u5230\u6d88\u606f\u540e\u6309\u7167",(0,i.jsx)(n.code,{children:"appDestination"}),"\u8def\u7531\u5230\u5bf9\u5e94\u7684\u5904\u7406\u51fd\u6570"]}),"\n",(0,i.jsxs)(n.li,{children:["\u5904\u7406\u51fd\u6570\u6309\u7167",(0,i.jsx)(n.code,{children:"replyDestination"}),"\u548c",(0,i.jsx)(n.code,{children:"replyAppDestination"}),"\u56de\u590d\u54cd\u5e94"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"appdestination\u7ea6\u5b9a",children:"appDestination\u7ea6\u5b9a"}),"\n",(0,i.jsxs)(n.p,{children:["\u56e0\u4e3a\u5927\u5bb6\u90fd\u6bd4\u8f83\u719f\u6089rest\u8def\u5f84\uff0c\u6240\u4ee5\u8fd9\u91cc\u4e5f\u7ea6\u5b9a\u91c7\u7528\u7c7b\u4f3c\u8def\u5f84\u89c4\u5219\uff0c\u4e5f\u5c31\u662f",(0,i.jsx)(n.code,{children:"aaa/bbb/ccc"}),"\u8fd9\u79cd\uff0c\n\u53e6\u5916\u4e3a\u4e86\u4e0d\u51b2\u7a81\uff0c\u7ea6\u5b9a\u7b2c\u4e00\u7ea7\u7684\u8def\u5f84\u540d",(0,i.jsx)(n.code,{children:"system"}),"\u7528\u4e8e\u7cfb\u7edf\u5c42\u901a\u4fe1\u800c\u4e0d\u80fd\u7528\u4e8e\u5e94\u7528"]}),"\n",(0,i.jsx)(n.h3,{id:"ping-pong",children:"ping pong"}),"\n",(0,i.jsxs)(n.p,{children:["\u56e0\u4e3a\u8fd9\u4e2a\u901a\u9053\u4e0d\u662f\u76f4\u8fde\u7684\uff0c\u6240\u4ee5\u4e3a\u4e86\u9a8c\u8bc1\u901a\u9053\u662f\u901a\u7684\uff0c\u6240\u6709\u76f8\u5173\u65b9\u90fd\u5e94\u8be5\u5b9e\u73b0\u6807\u51c6\u7684ping pong\u903b\u8f91\uff0c\n\u8fd9\u6837\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2a\u9a8c\u8bc1\u901a\u9053\u6b63\u5e38\uff0c\u5177\u4f53\u8def\u5f84",(0,i.jsx)(n.code,{children:"system/ping"}),"\uff0c",(0,i.jsx)(n.code,{children:"system/ping-rsp"})]})]})}function a(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>s,x:()=>c});var i=r(6540);const o={},t=i.createContext(o);function s(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);